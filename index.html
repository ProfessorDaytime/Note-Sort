<html style="width:100%">
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="css/mb.slider.css" media="screen" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.metadata/2.0/jquery.metadata.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="js/jquery.mb.slider.js"></script>
  <script src="js/d3.min.js"></script>
  <script src="js/algorithmSteps.js"></script>
  <script src="js/algorithms.js"></script>
  <script src="js/visualization.js"></script>
  <script src="js/songs.js"></script>
  <script>
    var sliderVal = 10;
    window.onload = function(){
      //Initialize the speed slider
      $("#speedSlider").mbSlider({
        showVal: true,
        formatValue: function (val) {
          //console.log(val);
          var formatVal = "Speed: " + val/4 + "x";
          sliderVal = val/4;
          console.log(sliderVal);
          return formatVal;
        }
      });

      writeSteps(["STEP 0","STEP 1","STEP 2","STEP 3","STEP 4","STEP 5","STEP 6","STEP 7","STEP 8","STEP 9"], [0, 1]);

    };
  </script>

</head>
<body style="width:100%; margin:0px">
  <div class="header">
    <img class = "logo" src="misc/LogoPlaceholder.png"/>
    <div class="sortFunctionButtons">
      <span class="sortFunctionButton" id="bubbleSort">BUBBLE</span>
      <span class="sortFunctionButton" id="mergeSort">MERGE</span>
      <span class="sortFunctionButton" id="quickSort">QUICK</span>
      <span class="sortFunctionButton" id="insertSort">INSERT</span>
      <span class="sortFunctionButton" id="selectSort">SELECT</span>
      <span class="sortFunctionButton" id="cocktailSort">COCKTAIL</span>
    </div>
  </div>
  <div class="mainArea">
    <div style="width:50%; height:100%; float:left; margin-top:50px;" id="myDiv"></div>
    <div style="width:50%; height:100%; float:right; overflow:auto" id="algStepsDiv"></div>
  </div>
  <div class="footer">
    <div class="controls">
      <div id="speedSlider" style="float: left" data-property="{rangeColor:'#F80A94',negativeColor:'#F80A94', startAt:20, grid:1, maxVal:20, minVal:1}"></div>
      <button type="button"  class="btn footerButton" id="pauseButton">Pause</button>
      <button type="button"  class="btn footerButton" id="stepButton">Step</button>
      <button type="button"  class="btn footerButton" id="resetButton">Reset</button>
      <button type="button"  class="btn footerButton" id="songButton">Choose Song</button>
    </div>

  </div>
  <script>
  $("#pauseButton").click(function() {
    if ($(this).text() == "Pause") {
      $(this).text("Play");
    }
    else {
      $(this).text("Pause");
    }
  });
  var i = 0;
  $("#stepButton").click(function() {
    writeSteps(quicksortCode, frames[i].algorithmSteps);
    i++;
  });
  $("#quickSort").click(function () {
    //Initialize song
    var songs = chromatic3Oct.slice(0);
    songs.reverse();
    //Run quicksort to generate frames
    i = 0;
    quicksort(songs, 0, songs.length-1);

    //Draw first frame
    draw(frames[0]);
    var frame = 0;

    var currGraphVals = [];

    function drawFrames(){
     setTimeout(function(){
       currGraphVals = frames[frame].data.map(function(obj){
          return obj.index;
        });
        d3.select("svg").remove();
        redraw(currGraphVals);
        writeSteps(quicksortCode, frames[frame].algorithmSteps);

        if ('notesToPlay' in frames[frame]){
          for(noteIndex of frames[frame].notesToPlay){
            var noteFilePath = frames[frame].data[noteIndex].noteFile;
            var audio = new Audio(noteFilePath);
            audio.play();
          }
        }

        frame++;
        console.log(sliderVal);
        if( frames.length > frame ){drawFrames();}
     }, 100/sliderVal)
    }
    drawFrames();

  });
  </script>
</body>
</html>
